<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Fairy Prompts</title>
	<style type="text/css">
		:root {
			--background-image: none;
		}

		html {
			box-sizing: border-box;
		}

		*,
		*:before,
		*:after {
			box-sizing: inherit;
		}

		p {
			margin: 0;
			padding: 0;
			font-weight: normal;
		}

		body,
		html {
			height: 100%;
			display: grid;
		}

		a {
			text-decoration: none;
			color: #fff;
			transition: opacity .2s ease-in;
		}

		a:hover {
			opacity: .5;
		}

		body {
			margin: 0;
			padding: .5rem;
			font-family: Iowan Old Style, Apple Garamond, Baskerville, Times New Roman, Droid Serif, Times, Source Serif Pro, serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
			background-color: #000;
			color: #fff;
			background-image: var(--background-image);
			backdrop-filter: blur(20px);
			background-size: 1900px;
		}

		.container {
			margin: auto;
			text-align: center;
			word-wrap: break-word;
			background-color: rgba(0, 0, 0, .85);
			box-shadow: 0 6px 4px rgba(0, 0, 0, .25);
			padding: 1rem 1.4rem;
			border-radius: 8px;
		}

		.lead {
			color: rgba(255, 255, 255, .65);
			font-size: calc(.7rem + 6vmin);
			margin-bottom: .5rem;
			user-select: none;
			animation-name: appear;
			animation-duration: 2s;
			animation-fill-mode: backwards;
		}

		.prompt {
			font-size: calc(1rem + 7vmin);
			animation-name: appear;
			animation-duration: 4s;
			animation-delay: 2s;
			animation-fill-mode: backwards;
		}

		.prompt:first-letter {
			text-transform: uppercase;
		}

		p:nth-child(3) {
			margin-top: .5rem;
			animation-delay: 4s;
			font-style: italic;
		}

		p:nth-child(4) {
			animation-delay: 6s;
		}

		@keyframes appear {
			from {
				opacity: 0;
			}

			to {
				opacity: 1;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<p class="lead">This week's prompt is</p>
		<p class="prompt" id="prompt"></p>
		<p class="lead">or</p>
		<p class="prompt" id="promptAlt"></p>
	</div>

	<script type="text/javascript" src="data.js"></script>
	<script type="text/javascript">
		function TSH(s) {
			for(var i = 0, h = 9; i < s.length;) {
				h = Math.imul(h ^ s.charCodeAt(i++), 9 ** 9);
			}

			return h ^ h >>> 9;
		}

		function mulberry32(a) {
			return function() {
				let t = a += 0x6D2B79F5;
				t = Math.imul(t ^ t >>> 15, t | 1);
				t ^= t + Math.imul(t ^ t >>> 7, t | 61);
				return ((t ^ t >>> 14) >>> 0) / 4294967296;
			}
		}

		function dateDiffInDays(a, b) {
			const utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
			const utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());

			return Math.floor((utc2 - utc1) / 86400000);
		}

		function init() {
			let dateIndex = Math.floor(dateDiffInDays(new Date('2022-11-07'), new Date()) / 7);

			const rand = mulberry32(TSH(dateIndex + 'Fairydale'));

			if (dateIndex > prompts.length - 1) {
				dateIndex = dateIndex % prompts.length;
			}

			document.getElementById('prompt').textContent = prompts[dateIndex];

			const palette = palettes[Math.floor(rand() * palettes.length)];

			const canvas = document.createElement('canvas');
			canvas.width = 100;
			canvas.height = 100;

			const ctx = canvas.getContext('2d');

			ctx.fillStyle = palette[0];
			ctx.fillRect(0, 0, canvas.width, canvas.height);

			const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
			const data = imageData.data;
			const pixelCount = data.length;

			for (let i = 0; i < pixelCount; i += 4) {
				if (rand() < .25) {
					data[i] = parseInt(palette[1].slice(1, 3), 16);
					data[i + 1] = parseInt(palette[1].slice(3, 5), 16);
					data[i + 2] = parseInt(palette[1].slice(5), 16);
				}
			}

			ctx.putImageData(imageData, 0, 0);
			document.documentElement.style.setProperty('--background-image', "url('" + canvas.toDataURL() + "')");

			const alternatePrompt = [
				adjectives[Math.floor(rand() * adjectives.length)],
				nouns[Math.floor(rand() * nouns.length)]
			];

			document.getElementById('promptAlt').innerHTML = '<a target="_blank" href="https://www.thefreedictionary.com/' + alternatePrompt[0] + '">' + alternatePrompt[0] + '</a> <a target="_blank" href="https://www.thefreedictionary.com/' + alternatePrompt[1] + '">' + alternatePrompt[1] + '</a>';
		}

		init();
	</script>
</body>
</html> 
